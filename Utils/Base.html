<!-- Code from d3-graph-gallery.com -->
<!DOCTYPE html>
<meta charset="utf-8">
<style>
    body {
      font-family:"avenir next", Arial, sans-serif;
      font-size: 12px;
      color: #696969;
    }

    #play-button {
      position: absolute;
      top: 140px;
      left: 50px;
      background: #f08080;
      padding-right: 26px;
      border-radius: 3px;
      border: none;
      color: white;
      margin: 0;
      padding: 0 12px;
      width: 60px;
      cursor: pointer;
      height: 30px;
    }

    #play-button:hover {
      background-color: #696969;
    }    
    
    .ticks {
      font-size: 10px;
    }

    .track,
    .track-inset,
    .track-overlay {
      stroke-linecap: round;
    }

    .track {
      stroke: #000;
      stroke-opacity: 0.3;
      stroke-width: 10px;
    }

    .track-inset {
      stroke: #dcdcdc;
      stroke-width: 8px;
    }

    .track-overlay {
      pointer-events: stroke;
      stroke-width: 50px;
      stroke: transparent;
      cursor: crosshair;
    }

    .handle {
      fill: #fff;
      stroke: #000;
      stroke-opacity: 0.5;
      stroke-width: 1.25px;
    }
</style>
<!-- Load d3.js and the geo projection plugin -->
<script src="https://d3js.org/d3.v4.js"></script>
<script src="https://d3js.org/d3-geo-projection.v2.min.js"></script>
<script src="https://d3js.org/d3-scale-chromatic.v1.min.js"></script>

<body>

<!-- Create an element where the map will take place -->
<svg id="my_dataviz" width="1130" height="550"></svg>
</body>

<script>


// The svg
var svg = d3.select("#my_dataviz"),
    width = +svg.attr("width"),
    height = +svg.attr("height");

// Map and projection
var projection = d3.geoMercator()
    .center([0,50])                // GPS of location to zoom on
    .scale(125)                       // This is like the zoom
    .translate([ width/2, height/2 ])

d3.queue()
  .defer(d3.json, "world.geojson")  // World shape
  .defer(d3.csv, "CSV/final-data.csv") // Position of circles
  .await(ready);

function ready(error, dataGeo, data) {

  console.log(data)
  var allContinent = d3.map(data, function(d){return(d.homecontinent)}).keys()
  var color = d3.scaleOrdinal()
    .domain(allContinent)
    .range(d3.schemePaired);

  // Add a scale for bubble size
  var valueExtent = d3.extent(data, function(d) { return +d.n; })
  var size = d3.scaleSqrt()
    .domain(valueExtent)  // What's in the data
    .range([ 1, 50])  // Size in pixel

  // Draw the map
  svg.append("g")
      .selectAll("path")
      .data(dataGeo.features)
      .enter()
      .append("path")
        .attr("fill", "#b8b8b8")
        .attr("d", d3.geoPath()
            .projection(projection)
        )
      .style("stroke", "none")
      .style("opacity", .3)

  // Add circles:
  function add(plot_date)
  { svg.selectAll("myCircles")
    .data(data.filter(function(d,i){ return d.date == plot_date }))
    .enter()
    .append("circle")
      .attr("cx", function(d){ 
        console.log(d)
        return projection([+d.longitude, +d.latitude])[0] })
      .attr("cy", function(d){ return projection([+d.longitude, +d.latitude])[1] })
      .style("opacity",1)
      .style("fill", function(d){ 
        if(d.category == "min")
          return "cyan" 
        else
          return "red"
        })
      .transition()
      .duration(2000)
      .attr("r", function(d){ return 5 })
      .style("opacity",0)
  }
    add("2013/08/07")

  //     svg.call(d3.zoom()
  //     .extent([[0, 0], [width, height]])
  //     .scaleExtent([1, 8])
  //     .on("zoom", zoomed));

  // function zoomed() {
  //   svg.selectAll("myCircles").attr("transform", d3.event.transform);
  // }

  // // Add title and explanation
  // svg
  //   .append("text")
  //     .attr("text-anchor", "end")
  //     .style("fill", "black")
  //     .attr("x", width - 10)
  //     .attr("y", height - 30)
  //     .attr("width", 90)
  //     .html("WHERE SURFERS LIVE")
  //     .style("font-size", 14)


  // // --------------- //
  // // ADD LEGEND //
  // // --------------- //

  // // Add legend: circles
  // var valuesToShow = [100,4000,15000]
  // var xCircle = 40
  // var xLabel = 90
  // svg
  //   .selectAll("legend")
  //   .data(valuesToShow)
  //   .enter()
  //   .append("circle")
  //     .attr("cx", xCircle)
  //     .attr("cy", function(d){ return height - size(d) } )
  //     .attr("r", function(d){ return size(d) })
  //     .style("fill", "none")
  //     .attr("stroke", "black")

  // Add legend: segments
  // svg
  //   .selectAll("legend")
  //   .data(valuesToShow)
  //   .enter()
  //   .append("line")
  //     .attr('x1', function(d){ return xCircle + size(d) } )
  //     .attr('x2', xLabel)
  //     .attr('y1', function(d){ return height - size(d) } )
  //     .attr('y2', function(d){ return height - size(d) } )
  //     .attr('stroke', 'black')
  //     .style('stroke-dasharray', ('2,2'))

  // Add legend: labels
  // svg
  //   .selectAll("legend")
  //   .data(valuesToShow)
  //   .enter()
  //   .append("text")
  //     .attr('x', xLabel)
  //     .attr('y', function(d){ return height - size(d) } )
  //     .text( function(d){ return d } )
  //     .style("font-size", 10)
  //     .attr('alignment-baseline', 'middle')
}

</script>