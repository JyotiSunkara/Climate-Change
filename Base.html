<!-- Code from d3-graph-gallery.com -->
<!DOCTYPE html>
<meta charset="utf-8">
<style>
  .axis .domain {
  display: none;
}
.slidecontainer 
{
  width: 100%;
}

.slider 
{
  -webkit-appearance: none;
  width: 30%;
  height: 15px;
  border-radius: 5px;  
  background: #d3d3d3;
  outline: none;
  opacity: 0.7;
  -webkit-transition: .2s;
  transition: opacity .2s;
}

.slider:hover 
{
  opacity: 1;
}

.slider::-webkit-slider-thumb 
{
  -webkit-appearance: none;
  appearance: none;
  width: 25px;
  height: 25px;
  border-radius: 50%; 
  background:grey;
  cursor: pointer;
}

.slider::-moz-range-thumb 
{
  width: 25px;
  height: 25px;
  border-radius: 50%;
  background: grey;
  cursor: pointer;
}

body 
{ 
  text-align: center;       
  padding: 5%; 
} 

</style>
<!-- Load d3.js and the geo projection plugin -->
<script src="https://d3js.org/d3.v4.js"></script>
<script src="https://d3js.org/d3-geo-projection.v2.min.js"></script>
<script src="https://d3js.org/d3-scale-chromatic.v1.min.js"></script>

<body>
    <h1>Climate Change</h1>
    <p>Drag the slider to change the year.</p>
  
    <div class="slidecontainer">
      <input type="range" min="1970" max="2020" value="1970" class="slider" id="myRange">
      <p>Year: <span id="demo">1970</span></p>
    </div>
<!-- Create an element where the map will take place -->
<svg id="my_dataviz" width="1130" height="550"></svg>
</body>

<script>

var slider = document.getElementById("myRange");
var output = document.getElementById("demo");
console.log("here")
slider.oninput = function() 
{
  output.innerHTML = (this.value);
}

// The svg
var svg = d3.select("svg"),
    width = +svg.attr("width"),
    height = +svg.attr("height");

// Map and projection
var projection = d3.geoMercator()
    .center([0,50])                // GPS of location to zoom on
    .scale(125)                       // This is like the zoom
    .translate([ width/2, height/2 ])

d3.queue()
  .defer(d3.json, "world.geojson")  // World shape
  .defer(d3.csv, "data.csv") // Position of circles
  .await(ready);

function ready(error, dataGeo, data) {

  console.log(data)
  // Create a color scale
  data = [{"homelat":27,"homelon":95,"homecontinent":"Asia","n":3600},
          {"homelat":28,"homelon":77,"homecontinent":"Asia","n":3600},
          {"homelat":12,"homelon":77,"homecontinent":"Asia","n":3600},
          {"homelat":22,"homelon":88,"homecontinent":"Asia","n":3600}
        ]
  var allContinent = d3.map(data, function(d){return(d.homecontinent)}).keys()
  var color = d3.scaleOrdinal()
    .domain(allContinent)
    .range(d3.schemePaired);

  // Add a scale for bubble size
  var valueExtent = d3.extent(data, function(d) { return +d.n; })
  var size = d3.scaleSqrt()
    .domain(valueExtent)  // What's in the data
    .range([ 1, 50])  // Size in pixel

  // Draw the map
  svg.append("g")
      .selectAll("path")
      .data(dataGeo.features)
      .enter()
      .append("path")
        .attr("fill", "#b8b8b8")
        .attr("d", d3.geoPath()
            .projection(projection)
        )
      .style("stroke", "none")
      .style("opacity", .3)

  // Add circles:
  svg
    .selectAll("myCircles")
    .data(data.sort(function(a,b) { return +b.n - +a.n }).filter(function(d,i){ return i<1000 }))
    .enter()
    .append("circle")
      .attr("cx", function(d){ 
        console.log(d)
        return projection([+d.homelon, +d.homelat])[0] })
      .attr("cy", function(d){ return projection([+d.homelon, +d.homelat])[1] })
      .transition()
      .duration(2000)
      .attr("r", function(d){ return 5 })
      .style("fill", function(d){ return "cyan" })
      .style("opacity",0)
  //     svg.call(d3.zoom()
  //     .extent([[0, 0], [width, height]])
  //     .scaleExtent([1, 8])
  //     .on("zoom", zoomed));

  // function zoomed() {
  //   svg.selectAll("myCircles").attr("transform", d3.event.transform);
  // }

  // // Add title and explanation
  // svg
  //   .append("text")
  //     .attr("text-anchor", "end")
  //     .style("fill", "black")
  //     .attr("x", width - 10)
  //     .attr("y", height - 30)
  //     .attr("width", 90)
  //     .html("WHERE SURFERS LIVE")
  //     .style("font-size", 14)


  // // --------------- //
  // // ADD LEGEND //
  // // --------------- //

  // // Add legend: circles
  // var valuesToShow = [100,4000,15000]
  // var xCircle = 40
  // var xLabel = 90
  // svg
  //   .selectAll("legend")
  //   .data(valuesToShow)
  //   .enter()
  //   .append("circle")
  //     .attr("cx", xCircle)
  //     .attr("cy", function(d){ return height - size(d) } )
  //     .attr("r", function(d){ return size(d) })
  //     .style("fill", "none")
  //     .attr("stroke", "black")

  // Add legend: segments
  svg
    .selectAll("legend")
    .data(valuesToShow)
    .enter()
    .append("line")
      .attr('x1', function(d){ return xCircle + size(d) } )
      .attr('x2', xLabel)
      .attr('y1', function(d){ return height - size(d) } )
      .attr('y2', function(d){ return height - size(d) } )
      .attr('stroke', 'black')
      .style('stroke-dasharray', ('2,2'))

  // Add legend: labels
  svg
    .selectAll("legend")
    .data(valuesToShow)
    .enter()
    .append("text")
      .attr('x', xLabel)
      .attr('y', function(d){ return height - size(d) } )
      .text( function(d){ return d } )
      .style("font-size", 10)
      .attr('alignment-baseline', 'middle')
}

</script>